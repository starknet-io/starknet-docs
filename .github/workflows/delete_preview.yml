name: Delete pull request preview workflow
on:
  pull_request:
    types:
      - closed

jobs:
#  delete-preview:
#    runs-on: ubuntu-latest
#    steps:
#      - name: Extract PR details
#        id: pr
#        run: |
#          PR_ID=pr-${{ github.event.pull_request.number }}
#          PREVIEW_PATH=previews/${PR_ID}
#          echo "::set-output name=PR_ID::${PR_ID}"
#      - name: Delete remote directory after merge
#        run: |
#          sshpass -p ${{ secrets.STAGING_PASS }} ssh -o StrictHostKeyChecking=no ${{ secrets.STAGING_USER }}@${{ secrets.STAGING_IP }} "rm -rf ~/public_html/${{ steps.pr.outputs.PR_ID }}"

  delete-site-preview:
    name: Delete Site Preview
    runs-on: ubuntu-latest
    steps:
#      - name: Checkout repository
#        uses: actions/checkout@v2
      - name: Identify and remove preview build directory
        run: |
#               PR_ID=pr-${{ github.event.after }}
               PR_ID=pr-${{ github.event.pull_request.number }}
               PREVIEW_PATH=previews/${PR_ID}
               if [ -d $PREVIEW_PATH ]; then
               rm -rf $PREVIEW_PATH
               git add .
               git commit -m "Delete preview build for PR $PR_ID after merging to master"
               git push origin gh-pages
               fi
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
