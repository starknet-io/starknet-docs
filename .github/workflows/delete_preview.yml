name: Delete pull request preview workflow
on:
  pull_request:
    types:
      - closed

jobs:
  delete-site-preview:
    name: Delete Site Preview
    runs-on: ubuntu-latest
    steps:
      - name: Identify and remove preview build directory
        run: |
               PR_ID=pr-${{ github.event.pull_request.number }}
               PREVIEW_PATH=previews/${PR_ID}
               if [ -d $PREVIEW_PATH ]; then
               rm -rf $PREVIEW_PATH
               git add .
               git commit -m "Delete preview build for PR $PR_ID after merging to master"
               git push origin gh-pages
               fi
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
